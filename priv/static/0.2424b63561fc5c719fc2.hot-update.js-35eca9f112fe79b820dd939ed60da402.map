{"version":3,"sources":["webpack:///./web/static/js/app/actions/sessionActions.js?14be"],"names":[],"mappings":"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","file":"0.2424b63561fc5c719fc2.hot-update.js","sourcesContent":["import { push }                           from 'react-router-redux';\nimport Constants                          from '../constants';\nimport { Socket }                         from 'phoenix';\nimport { httpGet, httpPost, httpDelete }  from '../utils';\n\nimport {loadRooms}  from './xmppActions';\n\nvar uuid = require('node-uuid');\nvar StanzaIO = require('stanza.io');\n\nimport {xmppSession} from  './xmppActions'\nvar pushNotifications = require('../helpers/pushNotifications');\n\n\n\nexport function setupClient(dispatch,user){\n    var config = {\n            jid: user.jid,\n            wsURL: \"ws://127.0.0.1:5280/websocket\",\n            transport: \"websocket\",\n            nickname: user.first_name,\n            credentials: {\n                password: localStorage.getItem('phoenixAuthToken')\n            }};\n\n     const client = StanzaIO.createClient(config);\n     client.enableKeepAlive({interval:30});\n     client.use(pushNotifications);\n     xmppSession(client,dispatch,user.jid);\n\n\n\n                client.once('session:started', function () {\n                    dispatch({\n                        type: Constants.APP_CONNECTED,\n                         });\n                });\n        client.connect();\n\n\n\n\n}\n\nexport function setCurrentUser(dispatch, user) {\n  const socket = new Socket('/socket', {\n    params: { token: localStorage.getItem('phoenixAuthToken') },\n    logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data); },\n  });\n\n  socket.connect();\n\n  const channel = socket.channel(`users:${user.id}`);\n\n  if (channel.state != 'joined') {\n    channel.join().receive('ok', () => {\n      dispatch({\n        type: Constants.CURRENT_USER,\n        currentUser: user,\n        socket: socket,\n        channel: channel,\n      });\n    });\n  }\n\n  channel.on('boards:add', (msg) => {\n    dispatch({\n        type: Constants.BOARDS_ADDED,\n        board: msg.board,\n      });\n  });\n\ndispatch(loadRooms());\n};\n\nconst Actions = {\n  signIn: (email, password) => {\n    return dispatch => {\n      const data = {\n        session: {\n          email: email,\n          password: password,\n        },\n      };\n\n      httpPost('/api/v1/sessions', data)\n      .then((data) => {\n        localStorage.setItem('phoenixAuthToken', data.jwt);\n        setCurrentUser(dispatch, data.user);\n        dispatch(push('/'));\n      })\n      .catch((error) => {\n        error.response.json()\n        .then((errorJSON) => {\n          dispatch({\n            type: Constants.SESSIONS_ERROR,\n            error: errorJSON.error,\n          });\n        });\n      });\n    };\n  },\n\n  currentUser: () => {\n    return dispatch => {\n      const authToken = localStorage.getItem('phoenixAuthToken');\n\n      httpGet('/api/v1/current_user')\n      .then(function (data) {\n        setCurrentUser(dispatch, data);\n              setupClient(dispatch,data);\n      })\n      .catch(function (error) {\n        console.log(error);\n        dispatch(push('/sign_in'));\n      });\n    };\n  },\n\n  signOut: () => {\n    return dispatch => {\n      httpDelete('/api/v1/sessions')\n      .then((data) => {\n        localStorage.removeItem('phoenixAuthToken');\n\n        dispatch({ type: Constants.USER_SIGNED_OUT, });\n\n        dispatch(push('/sign_in'));\n\n        dispatch({ type: Constants.BOARDS_FULL_RESET });\n      })\n      .catch(function (error) {\n        console.log(error);\n      });\n    };\n  },\n};\n\nexport default Actions;\n\n\n\n/** WEBPACK FOOTER **\n ** ./web/static/js/app/actions/sessionActions.js\n **/"],"sourceRoot":""}