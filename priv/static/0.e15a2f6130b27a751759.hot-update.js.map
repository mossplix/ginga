{"version":3,"sources":["webpack:///./web/static/js/app/reducers/contactReducer.js?5dc0"],"names":[],"mappings":"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","file":"0.e15a2f6130b27a751759.hot-update.js","sourcesContent":["import ActionTypes  from '../constants';\nvar _contacts={};\nconst ContactSchema = {\n    fetching: true,\n    id: '',\n    avatarID: '',\n    groups:  [],\n    inRoster:  false,\n    jid: true,\n    name:  '',\n    owner:  '',\n    storageId:  '',\n    subscription: 'none',\n    activeContact:  false,\n    avatar: '',\n    avatarSource: '',\n    lastInteraction: '',\n    lastHistoryFetch: '',\n    lastSentMessage: '',\n    lockedResource: '',\n    offlineStatus:  '',\n    topResource: '',\n    unreadCount:  0,\n    _forceUpdate:  0,\n    onCall:  false,\n    stream: {},\n};\n\n\nfunction chatState() {\n            var states = {};\n            this.resources.forEach(function (resource) {\n                states[resource.chatState] = true;\n            });\n\n            if (states.composing) return 'composing';\n            if (states.paused) return 'paused';\n            if (states.active) return 'active';\n            if (states.inactive) return 'inactive';\n            return 'gone';\n\n    }\n\n       function formattedTZO() {\n          var localTime = new Date();\n            if (!this.timezoneOffset) {\n              this.timezoneOffset=localTime.getTimezoneOffset();\n            };\n\n\n            var localTZO = localTime.getTimezoneOffset();\n            var diff = Math.abs(localTZO  % (24 * 60) - this.timezoneOffset % (24 * 60));\n            var remoteTime = new Date(Date.now() + diff * 60000);\n\n\n            var day = remoteTime.getDate();\n            var hour = remoteTime.getHours();\n            var minutes = remoteTime.getMinutes();\n\n            var days = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];\n\n            var dow = days[remoteTime.getDay()];\n            var localDow = days[localTime.getDay()];\n\n            var m = (hour >= 12) ? ' PM' : ' AM';\n\n            hour = hour % 12;\n            if (hour === 0) {\n                hour = 12;\n            }\n\n            var strDay = (day < 10) ? '0' + day : day;\n            var strHour = (hour < 10) ? '0' + hour : hour;\n            var strMin = (minutes < 10) ? '0' + minutes: minutes;\n\n            if (localDow == dow) {\n                return strHour + ':' + strMin + m;\n            } else {\n                return dow + ' ' + strHour + ':' + strMin + m;\n            }\n\n    }\n\n function call() {\n        if (this.jingleResources.length) {\n            var peer = this.jingleResources[0];\n            this.callState = 'starting';\n            app.api.call(peer.id);\n        } else {\n            logger.error('no jingle resources for this user');\n        }\n    }\n\n    function onResourceChange () {\n        this.resources.sort();\n        this.topResource = (this.resources.first() || {}).id;\n        this._forceUpdate++;\n    }\n    function onResourceListChange() {\n        // Manually propagate change events for properties that\n        // depend on the resources collection.\n        this.resources.sort();\n\n        var res = this.resources.first();\n        if (res) {\n            this.offlineStatus = '';\n            this.topResource = res.id;\n        } else {\n            this.topResource = undefined;\n        }\n\n        this.lockedResource = undefined;\n    }\n\n\n\n function setAvatar() {\n        var self=this;\n        var contact = self;\n        var type = 'image/png';\n        var source='vcard';\n        self=this;\n        id=self.avatarID||\" \";\n        fetchAvatar(contact.jid, id, type, source, function (avatar) {\n            if (source == 'vcard' && self.avatarSource == 'pubsub') return;\n            contact.avatarID = avatar.id;\n            contact.avatar = avatar.uri;\n            contact.avatarSource = source;\n            _contacts[self.jid]=contact;\n            contact.save();\n        });\n    }\n\n\nfunction fetchHistory() {\n        return ;\n        var self = this;\n        var url=\"http://localhost:4000/chat/messages/?from=\"+self.jid+\"&to=\"+app.me;\n\n\n        request.get(url).then(function(res){\n\n          var results = JSON.parse(res.text);\n          _.each(results,function (message) {\n            message.archivedId=message.id;\n            message.owner = message.from;\n\n\n            message.acked = true;\n            MessageActionCreators.receiveRawMessage(message);\n\n          });\n\n        });\n\n    }\n\n\n\n\nfunction _addContacts(rawContacts) {\n    if (typeof rawContacts != 'undefined') {\n        me=new ContactSchema();\n        me.jid=app.me;\n        me.name= app.config.nickname;\n        me.setAvatar();\n        _contacts[app.me]=me;\n\n        rawContacts.forEach(function (cont) {\n            contact=_.assign(new ContactSchema(),cont);\n            contact.fetchHistory();\n            contact.setAvatar();\n\n            if (!_contacts[cont.jid]) {\n\n                _contacts[contact.jid] = contact;\n\n            }\n        });\n    }\n}\n\nexport default function reducer(state = {}, action = {}) {\n  switch (action.type) {\n    case ActionTypes.RECEIVE_RAW_CONTACTS:\n            var roster= action.rawContacts;\n            _addContacts(roster);\n\n          return { ...contactsById,  [action.threadID]: threadsByID[action.threadID] || null, };\n\n      case ActionTypes.CLIENT_ON_JINGLE_INCOMING:\n\n          return { ...state };\n\n\n        case ActionTypes.CLIENT_ON_SESSION_STARTED:\n            //contactUtils.getRoster();\n             return { ...state};\n\n        case ActionTypes.CLIENT_ON_ROSTER_UPDATE:\n            var iq=action.iq;\n            var roster = iq.roster.items;\n\n            _rosterVer = iq.roster.ver;\n\n            _.each(roster, function (item) {\n                var contact = _contacts[item.jid];\n\n                if (item.subscription === 'remove') {\n                    if (contact) {\n                        delete _contacts[item.jid];\n                    }\n                    return;\n                }});\n\n             return { ...state};\n\n        case ActionTypes.CLIENT_ON_AVAILABLE:\n                var pres =action.pres;\n\n                var contact = _contacts[pres.from.bare];\n\n                if (contact) {\n                    delete pres.id;\n                    pres.show = pres.show || '';\n                    pres.status = pres.status || '';\n                    pres.priority = pres.priority || 0;\n\n                    var resource = ResourceStore.get(pres.from.bare);\n                    if (resource) {\n                        pres.from = pres.from.full;\n                        // Explicitly set idleSince to null to clear\n                        // the model's value.\n                        if (!pres.idleSince) {\n                            pres.idleSince = null;\n                        }\n                       // ResourceStore.set(pres.from.bare,\"pres\",pres);\n                    } else {\n\n\n                        //XmppUtils.createResource(pres,pres.from.bare);\n                    }\n\n                    var muc = pres.muc || {};\n                    if (muc.codes && muc.codes.indexOf('110') >= 0) {\n                        contact.joined = true;\n                    }\n\n                    _contacts[pres.from.bare]=contact;\n\n                }\n\n\n             return { ...state};\n\n            case ActionTypes.CLIENT_ON_UNAVALILABLE:\n                var pres =action.pres;\n\n                var contact = _contacts[pres.from.bare];\n                if (contact) {\n                    var resource = ResourceStore.get(pres.from.full);\n                    if (resource) {\n                        if (resource.id === contact.lockedResource) {\n                            contact.lockedResource = '';\n                        }\n\n                        if (contact.resources.length === 1) {\n                            contact.offlineStatus = pres.status;\n                        }\n                        delete contact.resources[resource.id];\n                    }\n\n                    var muc = pres.muc || {};\n                    if (muc.codes && muc.codes.indexOf('110') >= 0) {\n                        contact.joined = false;\n                    }\n\n                    _contacts[pres.from.bare]=contact;\n                }\n                 return { ...state};\n\n                case ActionTypes.CLIENT_ON_AVATAR:\n                    var info = action.info;\n\n\n                    var contact = _contacts[info.jid.bare];\n                    if (!contact) {\n                        if (app.jid === info.jid) {\n                            contact = _contacts[app.jid];\n                        } else {\n                            return;\n                        }\n                    }\n\n                    var id = '';\n                    var type = 'image/png';\n                    if (info.avatars.length > 0) {\n                        id = info.avatars[0].id;\n                        type = info.avatars[0].type || 'image/png';\n                    }\n\n\n\n                 return { ...state};\n                case ActionTypes.CLIENT_ON_CHAT_STATE:\n                    var info = action.info;\n                     var me= new RegExp(app.jid);\n\n                    var contact = _contacts[info.from.bare];\n                    if (contact) {\n                        var resource = contact.resources[info.from.full];\n                        if (resource) {\n                            resource.chatState = info.chatState;\n                            if (info.chatState === 'gone') {\n                                contact.lockedResource = undefined;\n                            } else {\n                                contact.lockedResource = info.from.full;\n                            }\n\n\n\n                        }\n                    } else if (me.test(info.from.bare)) {\n                        if (info.chatState === 'active' || info.chatState === 'composing') {\n                            contact = contactStore.get(info.to.bare);\n                            if (contact) {\n                                contact.unreadCount = 0;\n                            }\n                        }\n                    }\n                    _contacts[info.from.bare]=contact;\n                     return { ...state};\n\n\n    default:\n      return state;\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./web/static/js/app/reducers/contactReducer.js\n **/"],"sourceRoot":""}