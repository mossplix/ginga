{"version":3,"sources":["webpack:///./web/static/js/app/reducers/suggestionsReducer.js?166e"],"names":[],"mappings":"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","file":"0.3fd560def863edcf6624.hot-update.js","sourcesContent":["import ActionTypes  from '../constants';\n\n\n  function markInactive   () {\n        if (this.focused) {\n            return this.markActive();\n        }\n\n        _active = false;\n        _idleSince = new Date(Date.now());\n\n    }\n\nfunction registerSuggestionBox(id,state) {\n        state[id]={\n            pretext: '',\n            matchedPretext: '',\n            terms: [],\n            items: [],\n            components: [],\n            selection: ''\n        };\n    return state;\n    }\n\n   function  unregisterSuggestionBox(id,state) {\n        delete state[id];\n       return state;\n    }\n\n    function clearSuggestions(id,state) {\n        var  suggestion = state[id];\n\n        suggestion.matchedPretext = '';\n        suggestion.terms = [];\n        suggestion.items = [];\n        suggestion.components = [];\n        state[id] =suggestion;\n       return state;\n    }\n\n    function clearSelection(id,state) {\n        var  suggestion = state[id];\n\n        suggestion.selection = '';\n        state[id]=suggestion;\n        return state;\n    }\n\n    function hasSuggestions(id,state) {\n        return state[id].terms.length > 0;\n    }\n\n    function setPretext(id, pretext,state) {\n        var suggestion = state[id];\n\n        suggestion.pretext = pretext;\n        state[id] = suggestion;\n        return state;\n    }\n\n    function setMatchedPretext(id, matchedPretext,state) {\n        var suggestion = state[id];\n\n        suggestion.matchedPretext = matchedPretext;\n        state[id] = suggestion;\n        return state;\n    }\n\n    function addSuggestion(id, term, item, component,state) {\n        var  suggestion = state[id];\n\n        suggestion.terms.push(term);\n        suggestion.items.push(item);\n        suggestion.components.push(component);\n         state[id] = suggestion;\n        return state;\n    }\n\n   function  addSuggestions(id, terms, items, component,state) {\n        var suggestion = state[id];\n        var newState=state;\n\n        suggestion.terms.push(...terms);\n        suggestion.items.push(...items);\n\n        for (let i = 0; i < terms.length; i++) {\n            suggestion.components.push(component);\n        }\n       newState[id] = suggestion;\n       return newState;\n    }\n\n    // make sure that if suggestions exist, then one of them is selected. return true if the selection changes.\n    function ensureSelectionExists(id,state) {\n        var suggestion = state[id];\n\n        if (suggestion.terms.length > 0) {\n            // if the current selection is no longer in the map, select the first term in the list\n            if (!suggestion.selection || suggestion.terms.indexOf(suggestion.selection) === -1) {\n                suggestion.selection = suggestion.terms[0];\n\n                return true;\n            }\n        } else if (suggestion.selection) {\n            suggestion.selection = '';\n\n\n        }\n\n        state[id] = suggestion;\n       return state;\n    }\n\n    function getPretext(id,state) {\n        return state[id].pretext;\n    }\n\n    function getMatchedPretext(id,state) {\n        return state[id].matchedPretext;\n    }\n\n   function  getItems(id,state) {\n        return state[id].items;\n    }\n\n    function getTerms(id,state) {\n        return state[id].terms;\n    }\n\n   function  getComponents(id,state) {\n        return state[id].components;\n    }\n\n   function  getSelection(id,state) {\n        return state[id].selection;\n    }\n\n    function selectNext(id,state) {\n        return setSelectionByDelta(id, 1,state);\n    }\n\n    function selectPrevious(id,state) {\n        return setSelectionByDelta(id, -1,state);\n    }\n\n    function setSelectionByDelta(id, delta,state) {\n        var suggestion = state[id];\n\n        let selectionIndex = suggestion.terms.indexOf(suggestion.selection);\n\n        if (selectionIndex === -1) {\n            // this should never happen since selection should always be in terms\n            throw new Error('selection is not in terms');\n        }\n\n        selectionIndex += delta;\n\n        if (selectionIndex < 0) {\n            selectionIndex = 0;\n        } else if (selectionIndex > suggestion.terms.length - 1) {\n            selectionIndex = suggestion.terms.length - 1;\n        }\n\n        suggestion.selection = suggestion.terms[selectionIndex];\n\n    state[id] = suggestion;\n    return state;\n    }\n\nexport default function reducer(state = {}, action = {}) {\n     const  { id, ...other} = action;\n\n     switch (action.type) {\n\n\n         case ActionTypes.SUGGESTION_PRETEXT_CHANGED:\n             var toret=state;\n             toret=clearSuggestions(id,toret);\n\n            toret=setPretext(id, other.pretext,toret);\n            toret=ensureSelectionExists(id,toret);\n\n            return {...toret};\n\n        case  ActionTypes.SUGGESTION_RECEIVED_SUGGESTIONS:\n            var toret=state;\n              if (getMatchedPretext(id,state) === '') {\n                toret=setMatchedPretext(id, other.matchedPretext,toret);\n\n                // ensure the matched pretext hasn't changed so that we don't receive suggestions for outdated pretext\n                toret=addSuggestions(id, other.terms, other.items, other.component,toret);\n\n                toret=ensureSelectionExists(id,toret);\n\n            }\n\n\n\n            return { ...toret };\n        case ActionTypes.SUGGESTION_CLEAR_SUGGESTIONS:\n             var toret = clearSuggestions(id,state);\n             toret = clearSelection(id,toret);\n\n            return {...toret };\n         case ActionTypes.SUGGESTION_SELECT_PREVIOUS:\n\n\n            return selectNext(id,state);\n\n        case ActionTypes.SUGGESTION_SELECT_NEXT:\n\n            return selectPrevious(id,state);\n        case ActionTypes.SUGGESTION_COMPLETE_WORD:\n            var t_term= other.term||getSelection(id,suggestions)|| getMatchedPretext(id,suggestions);\n            var toret=state;\n            var suggestion = toret[id];\n            suggestion.matched_term=t_term;\n            toret[id]=suggestion;\n\n            //var toret = setPretext(id, '',state);\n            //toret = clearSuggestions(id,toret);\n            //toret = clearSelection(id,toret);\n\n          return {...toret };\n\n        case ActionTypes.REGISTER_SUGGESTION_BOX:\n\n            return registerSuggestionBox(id,state);\n        case ActionTypes.UNREGISTER_SUGGESTION_BOX:\n            return unregisterSuggestionBox(id,state);\n        case ActionTypes.ADD_SUGGESTIONS:\n\n            var tr = addSuggestions(id, other.terms, other.items, other.component,state);\n            console.log(tr);\n            return {...tr};\n\n        case ActionTypes.SET_MATCHED_PRETEXT:\n\n            return setMatchedPretext(id, other.text,state);\n        case ActionTypes.CLEAR_SELECTION:\n\n            return clearSelection(id,state);\n\n\n    default:\n      return state;\n  }\n}\n\n\n\nexport const currentSuggestion  = function reducer(state = {\n            pretext: '',\n            matchedPretext: '',\n            terms: [],\n            items: [],\n            components: [],\n            selection: '',\n    id:null\n        }, action = {}) {\n     const  { id, ...other} = action;\n     switch (action.type) {\n\n          case ActionTypes.REGISTER_SUGGESTION_BOX:\n                 return {id: id };\n         case ActionTypes.SUGGESTION_COMPLETE_WORD:\n             const suggestion = store.getState().suggestions[id];\n             return {id:id,term: other.term || getSelection(id,state)|| getMatchedPretext(id,state),suggestion:suggestion,hasSuggestions:suggestion.terms.length > 0};\n\n    default:\n      return state;\n  }\n}\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./web/static/js/app/reducers/suggestionsReducer.js\n **/"],"sourceRoot":""}