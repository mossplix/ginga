{"version":3,"sources":["webpack:///./web/static/js/app/reducers/threadReducer.js?506d"],"names":[],"mappings":"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","file":"0.a19a79d8052bb20502d7.hot-update.js","sourcesContent":["import ActionTypes  from '../constants';\n\n\n\n\nfunction _addToThread(roster){\n    if (typeof roster != 'undefined'){\n        roster.forEach(function (contact) {\n\n                var threadID = contact.jid;\n                var thread = _threads[threadID];\n                if (thread) {\n                    return;\n                }\n\n                _threads[threadID] = {\n                    id: threadID,\n                    name: contact.jid,\n                    lastMessage: null\n                };\n            }, this);\n\n\n\n}}\n\nfunction getThread(message){\n     var jid=store.getState().xmpp.jid;\n      var threadID = message.from;\n      if (threadID === jid)\n      {\n        threadID = message.to\n      }\n    return threadID;\n\n}\n\n\nfunction toThreads(messages) {\n      if (typeof messages != 'undefined'){\n\n          var jid=store.getState().xmpp.jid;\n          var _currentID = store.getState().currentChat.id;\n          var _threads={};\n\n          messages.forEach(function (message) {\n              if (message.type === \"chat\") {\n\n                  var threadID = message.from;\n                  if (threadID === jid)\n                  {\n\n                    threadID = message.to\n\n                  }\n\n\n                  var thread = _threads[threadID];\n                  if (thread && thread.lastTimestamp > message.created) {\n                      return;\n                  }\n                  _threads[threadID] = {\n                      id: threadID,\n                      name: threadID ,\n                      lastMessage: message\n                  };\n              }});\n\n\n          if  (_currentID && _threads[_currentID] && typeof _threads[_currentID].lastMessage != null ) {\n              _threads[_currentID].lastMessage.isRead = true;\n          }\n      }\n    return _threads;\n  }\n\n\nfunction getAllChrono(_threads) {\n    var orderedThreads = [];\n    for (var id in _threads) {\n      var thread = _threads[id];\n      orderedThreads.push(thread);\n    }\n    orderedThreads.sort(function(a, b) {\n        if (!a.lastMessage === null) {\n\n            if (a.lastMessage._created < b.lastMessage._created) {\n                return -1;\n            } else if (a.lastMessage._created > b.lastMessage._created) {\n                return 1;\n            }\n        }else{\n            return -1;\n        }\n      return 0;\n\n    });\n    return orderedThreads;\n  }\n\n\n\n  function getCurrentID() {\n    return _currentID;\n  }\n\n  function getCurrent() {\n    return this.get(this.getCurrentID());\n  }\n\n\nexport default function reducer(state = {}, action = {}) {\n  switch (action.type) {\n      case ActionTypes.CLICK_THREAD:\n        var thread= state[action.threadID]\n        if (typeof thread  != 'undefined') {\n            if (thread.lastMessage) {\n                thread.lastMessage.isRead = true;\n            }\n        }\n      return { ...state,[action.threadID]:thread };\n\n    case ActionTypes.LOAD_MESSAGES:\n      var th=toThreads(action.messages);\n\n      return {...state,...th};\n\n      case ActionTypes.RECEIVE_RAW_MESSAGE:\n        var msg=action.msg;\n        var message = msg;//ChatMessageUtils.convertDbMessage(msg,{});\n        thread=_threads[message.from]\n        thread.lastMessage=message;\n        _threads[message.from]=thread;\n\n        return { ...state };\n\n      case ActionTypes.LOAD_CONTACTS:\n          var roster= action.rawContacts;\n          _addToThread(roster);\n          return { ...state };\n       case ActionTypes.CLIENT_ON_CHAT:\n            var msg = action.msg;\n            var id = getThread(msg);\n\n            return {...state,[id]:{id:id,name:id,lastMessage:action.msg}};\n\n\n      case ActionTypes.CLIENT_ON_GROUPCHAT:\n          var msg=action.msg;\n           var id = getThread(msg);\n\n           return {...state,[id]:{id:id,name:id,lastMessage:action.msg}};\n\n      case ActionTypes.MESSAGE_SENT:\n          var msg=action.message;\n          var id = getThread(msg);\n\n          return {...state,[id]:{id:id,name:id,lastMessage:action.msg}};\n\n    default:\n      return state;\n  }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./web/static/js/app/reducers/threadReducer.js\n **/"],"sourceRoot":""}